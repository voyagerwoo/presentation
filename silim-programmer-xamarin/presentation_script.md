안녕하세요 자마린을 주제로 발표하게된 우여명입니다.

---

저는 이 일을 한지 만 삼년이 넘었고요. 
안정성, 생산성, 흥미 이 세가지의 어떻게 조화롭게 만족시킬까에 대해서 고민이 많은 사람입니다.
아직까지는 자바와 자바스크립트가 제일 편한 언어이고요, 
iOS, Android 앱은 만들어본 경험이 없고, 최근에 윈도우 10 전용 UWP 앱을 만들어봤습니다.
그리고 Microsoft 개발 환경에 대해서는 UWP를 하면서 처음 접하게 되었고요.

---

발표는 대략 다음의 순서로 진행이 됩니다.

---

제가 자마린을 좀 공부해야겠다고 생각한 이유는 UWP 때문이었습니다. 
윈도우즈 10이 나오면서 MS 진영해서 새롭게 구축한 플랫폼입니다.
이 환경에서 개발을 했는데 너무 편하고 좋더라고요. 
C#이라는 언어도 좋고 XAML도 괜찮고 MVVM을 쉽게 적용할수 있어서 로직을 단순화 할 수 있어서 좋고,
누겟이라는 의존성 관리자도 좋았고요.
그래서 대충 듣기로 UWP랑 자마린은 거의 비슷하다고 하고 자마린으로 UWP, iOS, Android 다 할 수 있다니까
이거 개이득이다 싶어서 공부를 하기로 했습니다.

---

자마린은 지금 있는 기술과 팀과 사람으로 네이티브 앱을 만들 수 있습니다. 
여기서 지금 있는 기술은 C#입니다.

---

C# 코드 기반으로 여러 플랫폼의 앱을 만들수 있다는 것입니다.
네이티브 성능을 보장하고요, 각 플랫폼에서 제공하는 기능을 C#으로 모두 할 수 있다고 합니다.
또한 각 os가 업데이트 되었을 때도 최신의 기능을 그날 바로 지원해준다고 하네요.

---

사실 자마린은 그냥 각 플랫폼에서 언어를 C#으로 바꾸는 수준이었습니다.
그러나 이제는 자마린 폼즈라는 게 나옵니다. 오늘 주로 다룰 내용이 바로 이것인데요.
각 플랫폼에서 공유하는 프로젝트입니다. 
앱의 흐름을 추상화한 고수준 프로젝트라고 하는데 뒤에가서 좀더 이야기 하도록 하고요,
당연히 C#, XAML로 개발하고 일반적인 UI를 구현할 수 있습니다.
예를 들어 입력 폼이나 버튼 등의 컴포넌트 혹은 레이아웃 등이죠. 
만약 요구사항이 간단하다면 이 폼즈만 가지고도 앱을 만들 수 있습니다.

Xamarin forms 사이트에서 인용했는데요, CRM 앱을 자마린으로 만들었는데, 96%나 코드를 공유했다고 합니다.
거의 폼즈 기술만으로 앱을 만든거죠.

---

구조를 보면 이전과 비교해서 share ui 코드 레이어가 생겼죠. 
뻔한 UI를 각 플랫폼별로 구현하던 수고를 줄였다고 보시면 되겠습니다.

---

이제는 프로젝트 구조와 코드를 보면서 어떤식으로 프로젝트를 구성하고 코드를 작성하는지 보시겠습니다.
이 앱은 자마린 프로젝트를 맨처음 만들었을 때 기본으로 생성되는 프로젝트에 제가 조금 기능을 추가한 프로젝트입니다.
우선 비주얼 스튜디오에서는 솔루션과 그 하위의 프로젝트로 구성이 되어있죠. 
솔루션의 이름이 CloneMasterDetail이고 그 하위에 CloneMasterDetail 프로젝트가 자마린 폼즈 프로젝트입니다.
그리고 각 플랫폼별로 프로젝트가 있고 폼즈 프로젝트를 참조합니다.

---

폼즈 프로젝트 구조를 한번 보시겠습니다.
이런 관례가 있다는 것을 확인하실 수 있습니다.
데이터인 모델과 비즈니스 로직을 처리하는 서비스 그리고 뷰에 표현될 데이터를 담고 있는 뷰모델, 그리고 실제 뷰가 있습니다.
App.xaml은 자마린 폼즈의 진입점이라고 보시면 됩니다.

---

예를 들어 안드로이드의 경우 메인 엑티비티에서 자마린 폼즈 앱을 로드하는 것을 보실 수 있습니다.

---

자마린의 UI Contols에 대해서 간략하게 알아보겠습니다.
UI를 표현하는 녀석들을 controls라고 하더라고요 윈도우즈에서는. 다른데서도 그런가요?
어쨌든, 앱의 한 화면, 즉 페이지를 표현하는 page, 위치나 크기를 표현하는 레이아웃, 버튼이나 라벨 같은 뷰가 있습니다.
재밌는건 템플릿을 나타내는 셀이라는 것도 있습니다.

---

예제 코드를 보시면 페이지 내에 툴바도 있고요, 
컨텐트에는 하나하나 쌓이는 스택 레이아웃에 리스트 뷰가 있는데 리스트 뷰의 항목에는 label로 제목이 있고 설명이 있네요.

---

근데 현실에서는 폼즈만으로는 안됩니다. 
작은 디자인 이슈에서 부터 네이티브 api를 사용해야하는 이슈까지말이죠.
결국에는 특정 플랫폼에 특화된 코드를 작성해야하는데 이제부터는 그 방법에 대해서 이야기 해보겠습니다.

플랫폼별 UI 작성 방법 세가지 입니다. 오늘은 위에 두가지에 대해서만 이야기 해보도록 하겠습니다.

---

우선 정말 간단한 UI 이슈는 OnPlatform이라는 기능을 사용해서 해결 할 수 있습니다.
코드에서 보시는 것처럼 iOS의 상태바 때문에 iOS에만 패딩을 20px 주고 싶을 때가 있습니다. 
저렇게 코드를 작성할 수 있습니다.

---

두번째로 커스텀 렌더러를 사용하는 방법입니다.
커스텀 렌더러는 개발자가 폼즈 컨트롤의 형태나 행동을 각 플랫폼별로 재정의 할 수 있게 합니다.

---

실제로 코드를 보면서 보시겠습니다.
xamarin forms 로는 밑줄이 있는 라벨을 만드는 것이 안됩니다. 그래서 커스텀 랜더러를 이용해서 만들어 보겠습니다.
우선 Label을 상속받은 UnderlineLabel을 만들어봅니다.
탭 클릭 기능도 넣어봅니다.

---

제가 UWP 프로젝트 렌더러를 만들어보겠습니다.
LabelRenderer를 상속받아 UnderlineLabelRenderer를 만듭니다.
그리고 assembly 어노테이션에 ExportRender로 오버라이드할 컨트롤을 정의합니다.

Renderer의 OnElementChanged 라는 메서드를 오버라이드해서 밑줄을 그어보겠습니다.
메서드 내부의 Control은 UWP 네이티브 Control 입니다. 
폼즈 label에 매칭되는 Textblock이라는 녀석입니다.
UWP 네이티브 코드로 underline이 생기도록 합니다.

그럼 잘 됩니다. 다른 플랫폼도 마찬가지로 작업을 합니다.

--- 

이번에는 페이지 자체를 커스텀 랜더러로 만들어보겠습니다.

사용자가 직접 터치로 메모하는 페이지를 만들어보려고 합니다.
우선 빈 페이지를 만듭니다.

---

페이지 이기 때문에 PageRenderer라는 걸 이용해봅니다.
같은 방식으로 하는데 이번에는 SetNativeControl 이라는 메서드를 통해서 페이지 전체를 위임합니다.
InkCanvasMemoPage 는 UWP 네이티브 페이지입니다.

---

그 다음으로 네이티브 기능을 사용하는 코드를 작성해보겠습니다.
앱을 만들다 보면 분명히 자마린 폼즈가 통일하지 못한 네이티브 기능들을 사용해야할 경우가 생깁니다.
그럴 때는 의존성 주입, 의존성 역전 패턴을 이용해서 네이티브 기능을 사용할 수 있습니다.

우선 폼즈 프로젝트에서 인터페이스를 정의하고 플랫폼별로 네이티브 기능을 이용해서 인터페이스 구현체를 만듭니다.
그리고 자마린 폼즈에서 제공하는 DependencyService에 등록을 합니다.

폼즈에서는 구현체 신경을 쓰지 않고 DependencyService에서 해당 타입을 가져오기만 하면 됩니다.
만약 없으면 에러가 나겠죠.

---

Xamarin forms 공식 사이티에서 알려주는 예제입니다.
텍스트를 읽는 네이티브 기능을 사용하는 코드입니다.

우선 인터페이스를 정의하고 언더라인 라벨을 눌렀을때 그 내용을 읽을 수 있도록 구현을 했습니다.

---

iOS 프로젝트에서 인터페이스 구현체를 네이티브 기능을 이용해서 만들면 끝입니다.
간단하죠.

---

데모를 해보겠습니다.

---

Xamarin Forms 결론입니다.

폼즈를 이용해 일반적인 UI를 표현할 수 있습니다. 
플랫폼 별로 UI 코드를 작성하던 노가다를 줄일 수 있죠.
표현 할 수 없는 UI도 Renderer나 오늘은 설명하지 못한 effect를 통해서 표현할 수 있습니다.
네이티브 기능도 아까 보시다시피 쉽게 쓸 수 있죠.

즉 자마린 폼즈는 일반적인 UI와 추상화된 앱의 흐름을 정의할 수 있습니다.
자세한 것은 각 플랫폼에서 재정의 혹은 구현만 하면 되는 것이죠.

---

참 좋은데 저는 이제 관심이 많이 시들해졌습니다.

도구의 안정성이 좀 부족하다는 느낌을 받았습니다. 특히 맥북에서.
윈도우에서 비주얼 스튜디오 + 젯브레인 리샤퍼를 쓰면 괜찮더라고요. 근데 이렇게 쓰려면 돈 많이 줘야합니다.

그리고 렌더러를 구현하다 보면서 네이티브를 모르니까 진짜 턱턱 막히더라고요.
결국 각 플랫폼 별로 api를 공부해야겠구나 생각했습니다. 

그리고 문제를 구글링 해도 잘 안나오길래 어느날 깃헙 스타수를 봤더니 유명 프로젝트인데 비해서 너무 적더라고요.
비슷한 프로젝트인 리엑트 네이티브는 5만개가 넘는데, 자마린은 1천8백개...
먼저 시작한 프로젝트임에도 인지도가 좀 낮구나 라고 생각했습니다.

---

그래서 결국 안드로이드를 공부하기로 했습니다.

---

앞으로 시간이 난다면 Android, iOS 따로 공부해보고 싶습니다.
네이티브를 하든, 리엑트 네이티브를 하든, 자마린을 하든 알아야할 것 같더라고요.
그리고 리엑트 네이티브를 좀더 알아보려고 합니다.

사실 자마린은 저희 팀에서 같이 쓰기에는 여러모로 불편한 점이 많았거든요.
그러나 저희 팀에서 리엑트를 잘 쓰고 있기 때문에 리엑트 네이티브도 충분히 잘 사용할 수 있을것 같습니다.

---

이제 결론을 내보겠습니다.
일반적인 UI를 하나의 코드로 표현하는 것은 상당히 매력적이다.
특히 c# 이라는 언어가 주는 매력이 꽤 괜찮더라고요.

그러나 앱을 개발하다 보면 네이티브 기능을 사용해야하고 결국 공부를 해야합니다.

특히 언어적인 문제보다 해당 개발 환경의 개념과 api를 잘 알아야겠더라고요.

저는 그래서 자마린 디깅을 중단하고 안드로이드 책을 보기로 마음을 먹었습니다.

---

이규원님의 동영상에서 좋은걸 많이 배웠습니다.
그리고 공식 사이트도 잘되있어요 자마린 유니버시티도 있는데, 자세히 안봤습니다. 

이것으로 발표를 마치겠습니다.
감사합니다.

---
